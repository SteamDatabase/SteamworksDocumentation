<h1>Steam Inventory Web Functions</h1>
These are structured web pages that you can redirect the user to.
<h2 class="bb_section"><a name="ItemCart"></a>Item Cart</h2>
ItemCart can be used to send a cart containing one or more items to be purchased via Steam. You'll
need to build and maintain the cart within your own game or UI, then send the contents of that cart
to Steam for purchase and activation of those items.<br />
<br />
Your store should direct the client browser to POST directly to
<code class="bb_code bb_code_inline nohighlight"
    >https://store.steampowered.com/itemcart/checkout</code
>
using a web form. From there, depending on the browser, the user will experience slightly different
purchase flows:
<h4>Stand-alone web browser (Chrome, Internet Explorer, etc):</h4>
<ul>
    <li>
        If wallet currency does not match, immediate redirect to return url with result code
        indicating mismatch (this provides an opportunity to modify the local currency of the store
        and resume checkout).<br />
    </li>
    <li>
        Shopping cart with individual line item costs in user currency, total cost in user currency,
        and "Purchase" / "Cancel" buttons.<br />
    </li>
    <li>If Cancel is selected, transaction will be cancelled with 'user declined' status.<br /></li>
    <li>If Purchase is selected, transaction will be automatically finalized.<br /></li>
    <li>User will be redirected to the appropriate return URL.</li>
</ul>
<h4>Steam Overlay / Big Picture web browser:</h4>
<ul>
    <li>Same as Standard Web Browser with no initial sign-in step; user cannot change account</li>
</ul>
<h4>In-game web browser with Steamworks API authentication cookie:</h4>
<ul>
    <li>
        If wallet currency does not match, immediate redirect to return url with result code
        indicating mismatch<br />
    </li>
    <li>Web page displays notice to use the Steam Overlay to authorize the purchase<br /></li>
    <li>Steam Overlay will activate automatically with a purchase/cancel dialog box<br /></li>
    <li>
        Overlay closes, flow continues as Standard Web Browser after user selects Purchase or Cancel
    </li>
</ul>
<h2 class="bb_subsection"><a name="1"></a>Example HTML</h2>
<div class="bb_code">
    &lt;form action="https://store.steampowered.com/itemcart/checkout" method="post"&gt; &lt;input
    type="hidden" name="appid" value="234560"&gt; &lt;input type="hidden" name="cart"
    value="1001,1006*2"&gt; &lt;input type="hidden" name="total" value="USD499"&gt; &lt;input
    type="hidden" name="sandbox" value="0"&gt; &lt;input type="hidden" name="return"
    value="http://mystore.com/checkout.php?fromsteam=1&amp;cartid=BA13522FE31&amp;result=[RESULT]&amp;orderid=[ORDERID]&amp;steamid=[STEAMID]&amp;name=[USERNAME]&amp;cc=[CURRENCY]&amp;auth=[AUTH]"&gt;
    &lt;input type="hidden" name="auth" value="9a38954f503bf38a16024a9ae9328e8fa780f5be"&gt;
    &lt;input type="hidden" name="lang" value="en"&gt; &lt;input type="image" src="checkout.png"
    alt="Checkout"&gt; &lt;/form&gt;
</div>
<br />
<ul>
    <li>appid - is your App ID number.<br /></li>
    <li>
        cart - is item definition index numbers separated by commas, with optional xN or *N quantity
        suffix. Order does not matter. Duplicates are treated as additional quantity.<br />
    </li>
    <li>
        total - is the expected total cost of the cart. Checkout will fail if this does not match.
        Format is upper-case currency type (USD, EUR, GBP, etc) followed by numeric total.<br />
    </li>
    <li>
        sandbox - is 1 or 0. Note that sandbox=1 will fail whenever sandbox testing is not
        specifically enabled for your app in Steamworks.<br />
    </li>
    <li>
        return - is a URL that the user will be sent to when checkout is complete and ready to be
        Finalized. Optional substitution fields described below.<br />
    </li>
    <li>
        auth - is the HMAC-SHA1 authentication code computed from the five preceding values in
        order, separated by newlines, using your Itemcart Secret Key. See sample PHP at end of
        document. Your secret key is visible from the Economy tab of your app's Steamworks
        configuration page.<br />
    </li>
    <li>
        lang - is an optional ICU language code ('en' for English) that sets the default language on
        the checkout page. This optional field is not authenticated.
    </li>
</ul>
<br />
The following strings will be substituted in the return url:<br />
<ul>
    <li>
        [RESULT] - result code ( 0 = success, 1 = user declined, 2 = currency mismatch, 3 or above
        is a internal failure code ).<br />
    </li>
    <li>
        [ORDERID] - 64-bit unsigned decimal integer representing Steam "orderid"; can be used with
        ISteamMicroTxn/QueryTxn api to verify transaction details - blank if user cancelled. Matches
        report generated by ISteamMicroTxn/GetReport<br />
    </li>
    <li>
        [STEAMID] - 64-bit unsigned decimal integer representing user's Steam ID. Blank if user
        declined to log in.<br />
    </li>
    <li>
        [USERNAME] - the user's chosen display name, encoded appropriately for a URL parameter.
        Blank if user declined to log in. CAUTION: sanitize for display - beware users named
        <code class="bb_code bb_code_inline nohighlight">&lt; script&gt;</code>!<br />
    </li>
    <li>
        [CURRENCY] - currency code for user's wallet (USD, EUR, etc) - blank if user declined to log
        in.<br />
    </li>
    <li>
        [AUTH] - the HMAC-SHA1 of the entire server-relative URL (eg, starting with "/checkout.php")
        computed as if [AUTH] were an empty string and everything else were already substituted. The
        HMAC key is your Itemcart secret key.
    </li>
</ul>
<br />
Sample PHP to generate "auth" value:<br />
<div class="bb_code php">
    define( 'SECRET_ITEMCART_KEY', '11111111111111111111111111111111' ); $appid = '234560';
    $cartstring = '1001,1006*2'; $totalstring = 'USD499'; $sandbox = '0'; // or '1' $returnurl =
    'http://mystore.com/checkout.php?fromsteam=1&amp;cartid=BA13522FE31&amp;result=[RESULT]&amp;orderid=[ORDERID]&amp;steamid=[STEAMID]&amp;name=[USERNAME]&amp;cc=[CURRENCY]&amp;auth=[AUTH]';
    $auth = hash_hmac( "sha1", "$appid\n$cartstring\n$totalstring\n$sandbox\n$returnurl",
    SECRET_ITEMCART_KEY );
</div>
<br />
Sample PHP to validate return URL:<br />
<div class="bb_code php">
    hash_hmac( "sha1", str_replace( $_GET['AUTH'], "", $_SERVER["REQUEST_URI"] ),
    SECRET_ITEMCART_KEY ) === $_GET['AUTH']
</div>
<br />
The authentication code in the sample HTML form is computed as if the Itemcart secret key is all
ones (32 characters long). Given the other field values (appid, cart, total, sandbox, return, lang)
you should be able to replicate the 'auth' value; if your generated 'auth' value does not match,
your code likely has errors which will prevent checkout from working.
<h2 class="bb_section"><a name="BuyItem"></a>BuyItem</h2>
BuyItem is a simple structured web page that allows a user to buy an in-game item using a simple
Steam purchase UI.
<h2 class="bb_subsection"><a name="2"></a>URI construction</h2>
Construct a URI for your item as follows, and direct the player to it:
<code class="bb_code bb_code_inline nohighlight"
    >https://store.steampowered.com/buyitem/{appid}/{itemdefid}/{quantity}</code
>
<h2 class="bb_subsection"><a name="3"></a>Parameters</h2>
<ul>
    <li><strong>appid</strong>: The ID of the application associated with the item.<br /></li>
    <li>
        <strong>itemdefid</strong>: The ItemDef ID to present for purchase. This item must have a
        price (or price_category) and must not be store_hidden. See the Item Schema.<br />
    </li>
    <li>
        <strong>quantity</strong>: Optional. Multiple instances of an item may be bought; if left
        off, a default of 1 is assumed.
    </li>
</ul>
<h2 class="bb_subsection"><a name="4"></a>Notes</h2>
This simplified page can only be used to sell instances of a single ItemDef (including a sellable
bundle). For a full-featured shopping cart, see ItemCart.<br />
<br />
See the Inventory Schema documentation for details on specifying items for sale, including pricing
and bundles.
