<h1>Uploading to Steam</h1>
Below is a guide to using SteamPipe, Valve's tool for delivering content to Steam. For more
information on best practices for updating your game, see
<a href="/doc/store/updates">Updating Your Game - Best Practices</a>.
<h2 class="bb_section"><a name="Introduction"></a>Introduction to the SteamPipe Content System</h2>
SteamPipe is the game/application content system that powers Steam. SteamPipe includes the following
features:<br />
<ul>
    <li>Efficient and fast content delivery.<br /></li>
    <li>Public and private "beta" branches, allowing multiple builds to be tested.<br /></li>
    <li>
        Simple web-based management of builds - push out a new build or rollback to a previous build
        with just a few clicks.<br />
    </li>
    <li>Ability to see the update size of a build before setting it live.<br /></li>
    <li>Ability to share content between multiple applications.<br /></li>
    <li>
        Ability to <a href="#Building_Retail_Install_Discs">build installer discs</a> from public or
        beta content.<br />
    </li>
    <li>Games/apps stay available offline even after an update download has been started.<br /></li>
    <li>
        All content is always encrypted, and non-active versions are not visible to customers.<br />
    </li>
    <li>
        A <a href="/doc/sdk/uploading/local_content_server">SteamPipe Local Content Server</a> which
        can be used during development.
    </li>
</ul>
<div class="bb_callout bb_yellow">
    <div>
        <strong>NOTE:</strong> There are a few concepts which are integral to SteamPipe, before
        getting started you should be familiar with all of the concepts outlined in the
        <a href="/doc/store/application">Applications</a> documentation. Having even a basic
        understanding of how these pieces fit together will be very useful when uploading your
        product to Steam.
    </div>
</div>
<h2 class="bb_section">
    <a name="AppStructureBestPractices"></a>Game Content Structure - Best Practices
</h2>
<br />
SteamPipe was designed for both efficient downloading of initial game installs and efficient
patching of updates. In general, it works well for a wide variety of game content structures.
However, there are some important things to know in terms of optimization and avoiding situations
that can cause inefficiency.<br />
<br />
<strong>Note:</strong> If your game uses <strong>Unreal Engine</strong>, please see the notes
specific to these pack files at the end of this section.<br />
<br />
SteamPipe initially splits each file into roughly one megabyte (MB) chunks. Each chunk is then
compressed and encrypted before being upload to the Steam content-delivery system. They remain
compressed and encrypted until downloaded by each client, where they are decrypted and expanded and
placed in the necessary file location(s). <br />
<br />
When SteamPipe is processing an update for an existing game, it searches to find any such chunks
that match the previous build of the game. This way, ideally only the new or modified portions of
any file are turned into "new" chunks, and those new chunks are the only pieces a client must
download to update their game.<br />
<br />
Many game engines use "pack" files to coalesce game assets, and improve load times by allowing more
efficient disk access. In general, this works well with SteamPipe. However, some pack file systems
use or enable using behaviors that can cause problems. The effect of these problems is almost always
that updates are much larger than necessary. They can also result in a quick download but a slow
update process as large amounts of local disk IO are necessary.<br />
<br />
If your game uses pack files, here are some general guidelines.<br />
<br />
<ul>
    <li>
        Ensure asset changes are <strong>localized</strong> within the pack file as much as
        possible<br />
    </li>
    <li><strong>Avoid shuffling</strong> asset ordering with a pack file<br /></li>
    <li><strong>limit</strong> pack file size <br /></li>
    <li>
        <strong>group</strong> assets by level / realm / feature into their own pack files, and
        consider adding new pack files for updates instead of modifying existing ones<br />
    </li>
    <li>
        do <strong>not</strong> include any original
        <strong>filenames or file / build timestamps</strong> for each asset
    </li>
</ul>
<br />
The first point above refers to the scope of what bytes are changed within a file when a single
asset is modified. If that asset's data is modified and/or grows or shrinks within the same location
of the pack file, that is ideal. SteamPipe will only create new chunks for the portions of the file
containing the asset data. However, all pack files need some sort of Table of Contents (TOC) as well
so that the engine can locate the asset data. The structure of this TOC can have a large impact on
the efficiency of SteamPipe patching. Ideally, there is one TOC or TOC tree near the beginning or
end of the file. Because other assets may shift byte position within the file, their TOC entries
will change as well. In this situation, SteamPipe will make new chunks for the modified asset data
and the modified portions of the TOC.<br />
<br />
However, what we have seen in some game engines is that the TOC information is distributed
throughout the file. Even worse, it uses absolute byte-offset values. So if an asset at byte 3450
increases in size by 8 bytes, then the offset values for all assets after this in the file change.
Even though each offset value is only 4 or 8 bytes in size, a change to an 8-byte number will result
in a new 1MB chunk being created by SteamPipe. This can have catastrophic effects where even
changing a few small assets in a pack file results in clients needing to download over half the
entire file to update. If you know or suspect that your pack file structure is causing this issue,
please contact your Valve representative as soon as possible. We have an alternate build algorithm
that can help mitigate this issue, though it has tradeoffs. <br />
<br />
Additionally, SteamPipe does not know about asset boundaries within a pack file. If sub-megabyte
assets are shuffled, it will most likely not be able to detect this reordering as the previously
determined 1-MB chunks will no longer be present within the file. So if, in the process of creating
an update for your game, you wish to optimize load times by reordering assets within the pack file,
be cognizant of the fact that it may result in a very large download for that update. We recommend
only doing this if the performance improvements are significant.<br />
<br />
Next - to update the pack file on a client device, SteamPipe builds the new version alongside the
old version. When all new files are built, it then "commits" the update by deleting old files and
moving the new files in. What this means is that to update a 25 GB pack file, SteamPipe will always
build a new, 25GB file. If the update only requires 10 bytes of changes to that file, SteamPipe will
need to copy almost the entire 25GB from the old file to the new file. Depending on the client
storage hardware, this can be a very slow process. For this reason, we recommend two things.<br />
<br />
First - limit the size of pack files. Probably one or two gigabytes (GB) is sufficiently large -
more than enough to allow efficient disk reads when loading the game. <br />
<br />
Second - keep the scope of assets within a single pack file fairly limited. Perhaps to a single game
level, or unlockable feature. This way, updates that are focused on specific parts of your game
don't cause the data from other parts to be copied around on the client machine. Additionally, when
adding new functionality / levels / etc, these can and likely should be placed in their own new pack
files. Clients downloading this update will have a simple download of new files, avoiding any of the
issues mentioned above with pack file modifications.<br />
<br />
When in doubt, you can use a local binary diff tool such as Beyond Compare to compare versions of
your pack files. Verify that the differences shown are of the size you expect for the changed
assets, and that there aren't perhaps dozens or hundreds of small changes spread out throughout the
file. If what you see is unexpected, check your pack file tool settings. <br />
<br />
<strong>Compression</strong>: Because Steam will compress all data for upload / storage / download,
we generally don't recommend using general compression on pack files. However, if you are concerned
about the on-disk size of your game, you may still want to use pack file compression. It will work
OK with SteamPipe so long as the criteria listed above are met. Specifically, you should ensure that
compression is per-asset as much as possible. Any compression that crosses asset boundaries will
spread out changes and require clients to download more data than necessary.<br />
<br />
<strong>Encryption</strong>: This is similar to compression - most likely unnecessary, and with the
same risks mentioned above.<br />
<br />
If you follow these rules you will minimize patch sizes and only new content will need to be
downloaded. Your customers will thank you for that and you will be able to increase the quality of
your product by shipping more updates.<br />
<br />
If you suspect that your game packaging is not interacting well with the SteamPipe update process,
please contact your Valve representative and we can look into enabling advanced features to help
with this. <br />
<br />
<strong>Unreal Engine</strong> - Special Notes<br />
<br />
Some versions of the Unreal Engine use asset "padding alignment" in the pack files which can have a
very large impact on the size of SteamPipe updates. This alignment can cause cascading asset shifts
when building new versions, especially if pack file compression is enabled. Using a padding
alignment of 1MB (1048576) will help ensure that re-alignments will shift assets by a multiple of
the same blocksize that SteamPipe uses for delta calculations. <br />
<br />
As an example, to change or specify your padding alignment when "cooking" your game pack files, you
will need to change one line inside the file
<code class="bb_code bb_code_inline nohighlight"
    >UnrealEngine/Engine/Source/Programs/AutomationTool/Win/WinPlatform.Automation.cs</code
>. That file contains a function
<code class="bb_code bb_code_inline nohighlight">GetPlatformPakCommandLine</code> -- inside that
function, change this line:<br />
<br />
<div class="bb_code">string PakParams = " -patchpaddingalign=2048";</div>
<br />
to this:<br />
<br />
<div class="bb_code">string PakParams = " -patchpaddingalign=1048576 -blocksize=1048576";</div>
<br />
With this change, you should be able to enable pack file compression and still get optimized
SteamPipe update behavior.<br />
<br />
<i>Unreal Engine is Epic’s trademark or registered trademark in the US and elsewhere.</i>
<h2 class="bb_section">
    <a name="BuildingYourGameTutorial"></a>Steamworks Video Tutorial - Building Your Game in
    SteamPipe
</h2>
This tutorial introduces SteamPipe and steps through building a sample application for Steam via the
Steamworks tools.<br />
<a href="https://www.youtube.com/watch?v=SoNH-v6aU9Q" target="_blank" rel="noreferrer"
    >https://www.youtube.com/watch?v=SoNH-v6aU9Q</a
>
<h2 class="bb_section">
    <a name="AddingPlatformsAndLanguagesTutorial"></a>Steamworks Video Tutorial - Adding New
    Platforms and Languages
</h2>
This tutorial walks you through adding new platforms and languages to your game by adding depots to
your app.<br />
<a href="https://www.youtube.com/watch?v=PShS32hcing" target="_blank" rel="noreferrer"
    >https://www.youtube.com/watch?v=PShS32hcing</a
>
<h4>SteamPipe Technical Details</h4>
SteamPipe uses the HTTP protocol for content delivery. Since downloads are regular web traffic, any
third-party HTTP cache between the customer and Steam servers will increase download speed. Content
can be hosted by external CDN providers, which can be easily added to our content network. Most
consumer firewalls allow HTTP traffic and won't block downloads.<br />
<br />
SteamPipe has an efficient patching algorithm based on binary deltas, only changing the modified
portions of existing content files. When this content is updated, only these deltas need be sent.
This means both developer and user transfers are smaller and faster. Most partners will find that
using a <a href="/doc/sdk/uploading/local_content_server">SteamPipe Local Content Server</a> not
necessary since they can efficiently patch builds on private branches.
<h2 class="bb_section"><a name="Build_Account"></a>Steam Build Account</h2>
Before you can create any builds on Steam, you must have a Steam account in your Steamworks account
with the "Edit App Metadata" and "Publish App Changes To Steam" permissions granted. For security
reasons it's recommended that you have a dedicated build account with just those permissions, you
may create a new Steam account for this purpose at
<a href="https://store.steampowered.com/join" target="_blank" rel="noreferrer"
    >https://store.steampowered.com/join</a
>.<br />
<br />
Any administrator of your Steamworks account can add a Steam account and grant the necessary
permissions. More information on this process can be found in the
<a href="/doc/gettingstarted/managing_users">Managing Your Steamworks Account</a> documentation. An
example of what this account might look like is:<br />
<br />
<img
    src="https://cdn.steamstatic.com/steamcommunity/public/images/steamworks_docs/english/create_build_account.png"
    alt="create_build_account.png"
    title="create_build_account.png"
/>
<div class="bb_callout">
    <div>
        <strong>Note:</strong> If the Steam account will need to set a build live for a released
        app, it will need either a phone number attached to their account or have the Steam Mobile
        App attached to their account. Those methods will be used to confirm setting a build live
        for a released app. Additionally, if the Steam account has any security changes (email,
        phone number, etc), then you will need to wait 3 days before you can set a build live for a
        released app. This is to prevent compromised accounts from being able to manage your app's
        released builds.
    </div>
</div>
<h2 class="bb_section"><a name="Initial_Setup_New_App"></a>Initial Setup for New SteamPipe Apps</h2>
Follow these steps to set up new SteamPipe apps:<br />
<ol>
    <li>
        Find the app ID for your application (this can be found by selecting the application on your
        homepage in Steamworks)<br />
    </li>
    <li>
        Go to the
        <a href="/apps/config/" target="_blank" rel="noreferrer">General Installation Settings</a>
        page for your app.<br />
    </li>
    <li>
        Define at least one launch option (the path and optionally, any arguments required to launch
        the game). Hover over the (?) to learn more about each field.<br />
        <br />
        The example below shows 5 launch options, 2 for Windows, 2 for macOS and 1 for Linux.<br />
        Launch option 3 will only be shown on Windows if the user also owns the DLC specified.<br />
        <br />
        <img
            src="https://cdn.steamstatic.com/steamcommunity/public/images/steamworks_docs/english/updatedlaunchoptions_3.png"
            alt="updatedlaunchoptions_3.png"
            title="updatedlaunchoptions_3.png"
        /><br />
    </li>
    <li>
        Go to the <a href="/apps/depots/" target="_blank" rel="noreferrer">Depots</a> page and add
        depots as needed for this app. By default, a depot may already be configured for your
        application.<br />
        <ol>
            <li>
                Click the default depot and change the name of the depot to a proper and
                recognizable name (such as "Base Content" or "Windows Content").<br />
            </li>
            <li>
                Leave the language set to [All languages] unless this is a language-specific
                depot.<br />
            </li>
            <li>
                Leave the OS set to [All OSes] unless this is an OS-specific depot (if the app is
                all-in-one, or is just PC or just Mac, it should be left to [All OSes]. Only specify
                for OS-specific game depots.<br />
            </li>
            <li>Click <strong>Add New Depot</strong> to create additional depots.<br /></li>
            <li>Click <strong>Save Changes</strong> to save any changes made.<br /></li>
        </ol>
    </li>
    <li>
        Once you are done defining your depots, publish the changes that you have made from the
        <a href="/apps/publishing" target="_blank" rel="noreferrer">Publish</a> page.<br />
    </li>
    <li>
        Your newly defined depots will need to be included in a package to grant you ownership of
        them. Each game on Steam should have a Developer Comp package which is automatically granted
        to the accounts listed within your publisher group.<br />
        You can add the new depots to that package (and/or other packages that should have these
        depots) on the
        <a href="/apps/associated" target="_blank" rel="noreferrer"
            >Associated Packages &amp; DLC</a
        >
        page.
    </li>
</ol>
<div class="bb_callout">
    <div>
        <strong>Note:</strong> If your executable is in a sub-folder of the main installation
        folder, add the sub-folder name in the Executable field. Don't use leading slashes or dots.
    </div>
</div>
<div class="bb_callout">
    <div>
        <strong>Platform Note:</strong> As shown above, macOS applications may be launched by
        specifying either an app bundle (Game.app) or a script/binary
        (Game.app/Contents/MacOS/Game). In general the app bundle format should be preferred if
        possible as it allows macOS to more correctly determine launch parameters in the manner it
        would if launched manually outside of Steam.<br />
        <br />
        One instance of this to note is that currently applications that are launched through an app
        bundle on Apple Silicon devices will launch the best architecture available in the
        application whereas direct binary launches will use the same architecture as the Steam
        process (currently x86_64).
    </div>
</div>
<h2 class="bb_section"><a name="1"></a>Setting up the SDK for SteamPipe uploads</h2>
Download and unzip the latest version of the Steamworks SDK on the machine you will be uploading
builds on.<br />
<br />
The SteamPipe tools can be found within the SDK in the
<code class="bb_code bb_code_inline nohighlight">tools</code> folder which contains 2 relevant
sub-directories. <br />
<br />
The <code class="bb_code bb_code_inline nohighlight">ContentBuilder</code> directory is where your
game content and SteamPipe build tools will live. This directory contains the following
sub-directories:<br />
<ul>
    <li>
        <strong>builder</strong> - This directory initially contains just steamcmd.exe which is the
        command line version of Steam.<br />
    </li>
    <li><strong>builder_linux</strong> - The linux version of steamcmd.<br /></li>
    <li><strong>builder_osx</strong> - The macOS version of steamcmd.<br /></li>
    <li>
        <strong>content</strong> - This directory contains all game files that will be built into
        depots.<br />
    </li>
    <li>
        <strong>output</strong> - This directory will be the location for build logs, chunk cache,
        and intermediate output. <strong>NOTE:</strong> This folder can be deleted or emptied at any
        time, but after it's deleted, the next upload time will take longer.<br />
    </li>
    <li>
        <strong>scripts</strong> - This directory is where you'll place all of your build scripts
        for building your game depots.
    </li>
</ul>
<img
    src="https://cdn.steamstatic.com/steamcommunity/public/images/steamworks_docs/english/steampipebuilddir.png"
    alt="steampipebuilddir.png"
    title="steampipebuilddir.png"
/><br />
<br />
It's recommended that you run steamcmd.exe directly in the builder folder for your platform once to
bootstrap your build system. This should populate your builder directory with all the files it needs
to build depots.<br />
<br />
The <code class="bb_code bb_code_inline nohighlight">ContentServer</code> directory contains the
tools for running your own
<a href="/doc/sdk/uploading/local_content_server">SteamPipe Local Content Server</a> if you choose
to do so.
<h2 class="bb_subsection"><a name="2"></a>SteamCmd on macOS</h2>
To enable SteamCmd on macOS you must complete the following steps:<br />
<ol>
    <li>From the terminal, browse to the tools\ContentBuilder\builder_osx<br /></li>
    <li>Run chmod +x steamcmd<br /></li>
    <li>Type bash ./steamcmd.sh<br /></li>
    <li>
        SteamCmd will then run and update to the latest build, leaving you in the SteamCmd prompt<br />
    </li>
    <li>Type exit and press return to exit the prompt</li>
</ol>
You can then follow the rest of this documentation (substituting paths as appropriate) to create
depot and app config files for uploading your content to Steam.
<h2 class="bb_section"><a name="3"></a>Creating SteamPipe Build Config Files</h2>
To upload files for your app with SteamPipe, you must create scripts which describe your build and
each depot that will be included in it. The example scripts shown here are in the
<code class="bb_code bb_code_inline nohighlight">Tools\ContentBuilder\scripts</code> folder in the
Steamworks SDK.
<h2 class="bb_subsection"><a name="steampipe_gui_tool"></a>SteamPipe GUI Tool</h2>
If you're running on Windows and would prefer a GUI tool to help create these config files and
upload your builds you can use the SteamPipeGUI which is available in the tools folder of the
Steamworks SDK. Included in the zip are additional instructions to get you started.<br />
<br />
If you choose to use the GUI tool then reading the following sections is still recommended to help
you become more familiar with how the SteamPipe system works.
<h2 class="bb_subsection"><a name="4"></a>Simple Build Script</h2>
<br />
Let's start with the most basic build script possible. In our example we have a game (AppID 1000)
that has one depot (DepotID 1001) and want to upload all files from a content folder and it's
subfolders. We just need a single build script for that, take a look at
<code class="bb_code bb_code_inline nohighlight">"simple_app_build.vdf"</code> included in the SDK :
<br />
<br />
<div class="bb_code">
    "AppBuild" { "AppID" "1000" // your AppID "Desc" "This is a simple build script" // internal
    description for this build "ContentRoot" "..\content\" // root content folder, relative to
    location of this file "BuildOutput" "..\output\" // build output folder for build logs and build
    cache files "Depots" { "1001" // your DepotID { "FileMapping" { "LocalPath" "*" // all files
    from contentroot folder "DepotPath" "." // mapped into the root of the depot "recursive" "1" //
    include all subfolders } } } }
</div>
<br />
Adjust the AppID and DepotID for your game as needed. To kick off a build you need to run steamcmd
and pass a couple of parameters :<br />
<div class="bb_code">
    tools\ContentBuilder\builder\steamcmd.exe +login &lt;account_name&gt; &lt;password&gt;
    +run_app_build ..\scripts\simple_app_build.vdf +quit
</div>
<br />
The following steps occur during a SteamPipe build:<br />
<ol>
    <li>steamcmd.exe will update itself to the latest version.<br /></li>
    <li>
        steamcmd.exe is logging into the Steam backend using the given builder Steam account.<br />
    </li>
    <li>
        The app build start is registered with the MDS (Master Depot Server), which will ensure the
        user has the proper privileges to modify this app.<br />
    </li>
    <li>
        For each depot included in the app build, a file list is generated based on the files in the
        content folder and the filter rules defined in depot build config file.<br />
    </li>
    <li>
        Each file is scanned and divided into small chunks of about 1MB. If the depot has been built
        before, this partitioning will preserve as many of the unchanged chunks as possible.<br />
    </li>
    <li>New file chunks are compressed, encrypted, and then uploaded to the MDS.<br /></li>
    <li>
        A final manifest is generated for this depot version; each manifest is identified by a
        unique 64-bit manifest ID.<br />
    </li>
    <li>
        Once all depots have been processed, the MDS finishes this app build and assigns it a global
        BuildID.<br />
    </li>
    <li>
        After the build is done, there may be *.csm and *.csd files in the build ouput folder. These
        are temporary and can be deleted, but they speed up subsequent build times.
    </li>
</ol>
<br />
<br />
Once the build is complete you can see it on your app builds page, in this case it would be
<a href="/apps/builds/1000" target="_blank" rel="noreferrer"
    >https://partner.steamgames.com/apps/builds/1000</a
>. There you can set that build live for the default branch or any beta branch and users will be
able to download this update within a couple of minutes.
<h2 class="bb_subsection"><a name="5"></a>Advanced Build Scripts</h2>
<br />
If your app has a lot of depots with complex file mapping rules, you can create a depot build script
for each depot which will be referenced by the app build script. First let's take a look at
available parameters in the app build script:<br />
<br />
<ul>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> AppID </code> - The AppID of your game.
        The uploading Steam partner account needs 'Edit App Metadata' privileges<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> Desc </code> - The description is only
        visible to you in the 'Your Builds' section of the App Admin panel. This can be changed at
        any time after uploading a build on the 'Your Builds' page.<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> ContentRoot </code> - The root folder of
        your game files, can be an absolute path or relative to the build script file.<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> BuildOutput </code> - This directory will
        be the location for build logs, depot manifests, chunk caches, and intermediate output. For
        best performance, use a separate disk for your build output. This splits the disk IO
        workload, letting your content root disk handle the read requests and your output disk
        handle the write requests. <br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> Preview </code> - This type of build only
        outputs logs and a file manifest into the build output folder. Building preview builds is a
        good way to iterate on your upload scripts and make sure your file mappings, filters and
        properties work as intended.<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> Local </code> - Set this to the htdocs
        path of your
        <a href="/doc/sdk/uploading/local_content_server">SteamPipe Local Content Server</a> (LCS).
        LCS builds put content only on your own HTTP server and allow you to test the installation
        of your game using the Steam client. <br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> SetLive </code> - Beta branch name to
        automatically set live after successful build, none if empty. Note that the 'default' branch
        can not be set live automatically. That must be done through the App Admin panel.<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight">Depots</code> - This section contains all
        file mappings, filters and file properties for each depot or references a separate script
        file for each depot
    </li>
</ul>
<br />
Example app build script
<code class="bb_code bb_code_inline nohighlight">"app_build_1000.vdf"</code> is using all
options:<br />
<div class="bb_code">
    "AppBuild" { "AppID" "1000" // Your AppID "Desc" "Your build description here" // internal
    description for this build "Preview" "1" // make this a preview build only, nothing is uploaded
    "Local" "..\..\ContentServer\htdocs" // put content on local content server instead of uploading
    to Steam "SetLive" "AlphaTest" // set this build live on a beta branch "ContentRoot"
    "..\content\" // content root folder relative to this script file "BuildOutput"
    "D:\build_output\" // put build cache and log files on different drive for better performance
    "Depots" { // file mapping instructions for each depot are in separate script files "1001"
    "depot_build_1001.vdf" "1002" "depot_build_1002.vdf" } }
</div>
<br />
This app build script references two depot build script files that specify all file mappings and
file properties. The following instructions are available in a depot build script ( and also if the
section is included directly into the app build script).<br />
<br />
<ul>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> DepotID </code> - The DepotID for this
        section<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> ContentRoot </code> - Lets you optionally
        override the ContentRoot folder from the app build script on a per depot basis<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> FileMapping </code> - This maps a single
        file or a set of files from the local content root into your depot. There can be multiple
        file mappings that add files to the depot. The
        <code class="bb_code bb_code_inline nohighlight"> LocalPath </code> parameter is a relative
        path to the content root folder and may contain wildcards like '?' or '*'. It will also
        apply to matching files in subfolders if
        <code class="bb_code bb_code_inline nohighlight">Recursive</code> is enabled. The
        <code class="bb_code bb_code_inline nohighlight"> DepotPath </code> parameter specifies
        where the selected files should appear in the depot (use just '.' for no special mapping)<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> FileExclusion </code> - will excluded
        mapped files again and can also contain wildcards like '?' or '*'<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> InstallScript </code> - will mark a file
        as <a href="/doc/sdk/installscripts">install scripts</a> and will sign the file during the
        build process. The Steam client knows to run them for any application which mounts this
        depot.<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"> FileProperties </code> - will mark a file
        with special flags:<br />
        <ul>
            <li>
                <code class="bb_code bb_code_inline nohighlight"> userconfig </code> - This file is
                modified by the user or game. It cannot be overridden by an update, and it won't
                trigger a verification error if it's different from the previous version of the
                file.<br />
            </li>
            <li>
                <code class="bb_code bb_code_inline nohighlight"> versionedconfig </code>- Similar
                to userconfig, however if the file is updated in the depot, it will be overwritten
                locally when the user's game updates. Only update the file in the depot when there
                is a necessary format change or bug fix.
            </li>
        </ul>
    </li>
</ul>
<br />
Example depot build script
<code class="bb_code bb_code_inline nohighlight">depot_build_1002.vdf</code> showing use of all
options:<br />
<div class="bb_code">
    "DepotBuild" { "DepotID" "1002" "ContentRoot" "C:\content\depot1002" // override ContentRoot
    from app build script "FileMapping" { // all source files and folders in ".\bin" will be mapped
    into folder ".\executables" in depot "LocalPath" "bin\*" "DepotPath" "executables\" "Recursive"
    "1" // include all subfolders } "FileMapping" { // override audio files in \\audio with German
    versions "LocalPath" "localization\german\audio\*" "DepotPath" "audio\" } "FileMapping" { //
    copy install script for german version into depot root folder "LocalPath"
    "localization\german\german_installscript.vdf" "DepotPath" "." } "FileExclusion"
    "bin\server.exe" // exclude this file "FileExclusion" "*.pdb" // exclude all .PDB files
    everywhere "FileExclusion" "bin\tools*" // exclude all files under bin\tools\ "InstallScript"
    "localization\german\german_installscript.vdf" "FileProperties" { "LocalPath" "bin\setup.cfg"
    "Attributes" "userconfig" // this file will be modified during runtime } }
</div>
<br />
<strong>NOTE:</strong> You can name these scripts what ever you want, but we use the names
<code class="bb_code bb_code_inline nohighlight">app_build_&lt;AppID&gt;</code> and
<code class="bb_code bb_code_inline nohighlight">depot_build_&lt;DepotID&gt;</code> for consistency.
If you know that you'll be building apps on this machine, it might be a good idea to create
sub-directories in your scripts directory for each application, to help organize each application's
build scripts.
<h2 class="bb_section">
    <a name="automating_steampipe"></a>Using SteamPipe In A CI/CD Environment
</h2>
<br />
To setup steamcmd for continuous integration, or just on a machine or VM that will get re-imaged
frequently, you'll need to include the config file that contains your login token. Follow these
steps so that your initial login token is properly saved:<br />
<br />
<ol>
    <li>
        Run "steamcmd.exe +login &lt;username&gt; on the machine that will be preforming the
        build"<br />
    </li>
    <li>Enter your password, and the SteamGuard token<br /></li>
    <li>Type "info", and you should see your account listed as connected<br /></li>
    <li>Type "quit"<br /></li>
    <li>
        For each future run, do not enter a password. Simply run "steamcmd.exe +login
        &lt;username&gt;"<br />
    </li>
    <li>
        Be sure that the config file stored in &lt;Steam&gt;\config\config.vdf is
        <strong>saved and preserved between runs</strong>, as this file may be updated after a
        successful login
    </li>
</ol>
<br />
<strong>NOTE:</strong> If you do login again and provide your password, a new SteamGuard token will
be issued and required to login.
<h2 class="bb_section"><a name="Managing_Updates"></a>Managing Updates</h2>
After your app releases to customers, your customers will be receiving the build marked as the
Default build. When uploading a new build it's always a good idea to test it before shipping it to
your customers, for more information on how to successfully do this see
<a href="/doc/store/testing">Testing On Steam</a>.
<h2 class="bb_section"><a name="Debugging_Build_Issues"></a>Debugging Build Issues</h2>
If your build wasn't successful, you should look in your output directory for error information, not
the console where the build script was run. Most error information can be found in the *.log
files.<br />
You can use these Steam client commands and client-side files to debug issues:<br />
<ul>
    <li>
        <code class="bb_code bb_code_inline nohighlight">"app_status [appid]"</code> - Shows the
        current state of the app on this client.<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight">"app_info_print [appid]"</code> - Shows the
        current Steamworks configuration for this game (depots, launch options, etc.).<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight">"app_config_print [appid]"</code> - Shows
        the current user configuration for this game (current language, install directory, etc.).<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight">file "logs\content_log.txt"</code> - Lists
        all logged SteamPipe operations and errors.<br />
    </li>
    <li>
        <code class="bb_code bb_code_inline nohighlight"
            >file "steamapps\appmanifest_[appid].acf"</code
        >
        - Shows the current install state of this app (KeyValues).
    </li>
</ul>
<h2 class="bb_section">
    <a name="Building_Retail_Install_Discs"></a>Building Retail Install Discs
</h2>
To build retail install disc for SteamPipe games, you must first setup a build project file.<br />
In this example, the SKU file is called "sku_goldmaster.txt":<br />
<div class="bb_code">
    "sku" { "name" "Test Game Installer" "appid" "202930" "disk_size_mb" "640" "included_depots" {
    "1" "202931" "2" "202932" } }
</div>
Some tips to keep in mind:<br />
<ul>
    <li>
        Create a new folder where the retail disc images will be written to, e.g.,
        "D:\retail_disks". Only depots in the included_depots sections are added; there is no
        exclude section anymore.<br />
    </li>
    <li>
        You can use Steam.exe (with the -dev and -console command-line parameters) or steamcmd.exe
        to build installer images. In both cases, use the "build_installer" command.<br />
    </li>
    <li>
        Log on with a Steam account that owns the game and all depots you want to put on the retail
        disc. Otherwise, the account doesn't need special rights, so anyone can build installer
        discs.<br />
    </li>
    <li>If you use Steam.exe, stop all other downloads.<br /></li>
    <li>
        Go to the console page and run the build_installer command:<br />
        <div class="bb_code">build_installer sku_goldmaster.txt "D:\retail_disks"</div>
        The build can take a while since all depots are re-downloaded the first time.<br />
    </li>
    <li>
        If you're building a GM using a local content server, run:<br />
        <code class="bb_code bb_code_inline nohighlight"> @localcontentserver "webserver"</code
        ><br />
        <code class="bb_code bb_code_inline nohighlight">
            build_installer sku_goldmaster.txt "D:\retail_disks" local</code
        ><br />
        The spew refers to 'Backup' since 'Retail install Disk' and local game backups are basically
        the same.<br />
    </li>
    <li>
        Once you see "Backup finished for AppID...", the install disk images are ready. You can find
        more details about the backup build in
        <code class="bb_code bb_code_inline nohighlight">logs\backup_log.txt</code>.<br />
    </li>
    <li>
        There are new folders (Disk_1, Disk_2, and so on) in "D:\retail_disks", each not bigger than
        640 MB, as specified with "disk_size_mb". Each disk folder contains a "sku.sis" file and a
        .csd and .csm for each depot. Bigger depots span across multiple disks. All retail install
        disk content is always encrypted (unlike local game backup files). Copy the SDK GM setup
        files (setup.exe, setup.ini, etc.) into the folder of your first disk and the retail disc
        installer is complete.<br />
    </li>
    <li>
        When creating a GM for macOS be sure to open the
        goldmaster/disk_assets/SteamRetailInstaller.dmg image on a Mac. Then take the app that is in
        there and copy it to the root of your media. You will probably want to change the name of
        the install app, brand the icon and decorate the window to only show the installer.<br />
    </li>
    <li>
        When creating a multi-disc GM for macOS, be sure the volume name for each disc matches. The
        volume name becomes part of the mount path, and if the names don't match the installer won't
        be able to find the next disc.
    </li>
</ul>
<h2 class="bb_subsection">
    <a name="6"></a>Optionally building a retail installer from a beta branch
</h2>
The process above will create a retail installer based on the default branch. If you need to create
an installer based on a beta branch, you must first create a beta branch named "baseline". Then use
the following command to build from the baseline branch:<br />
<div class="bb_code">
    build_installer &lt;project file&gt; &lt;target folder&gt; &lt;beta key&gt; &lt;beta pwd&gt;
    steamcmd ex: build_installer sku_goldmaster.txt "D:\retail_disks" baseline superSecret script
    ex: steamcmd.exe +login user_name password +build_installer "..\Build\GameDataSku.txt"
    c:\destination beta_key beta_password +exit
</div>
<h2 class="bb_subsection"><a name="7"></a>Installing DLC from a retail installer</h2>
In some circumstances, you may wish to create a retail installer that includes your DLC packages. In
such cases, the process to create the installer requires only a few changes.<br />
In "sku_goldmaster.txt", include the DLC AppIDs under the "included_depots" section. Once you have
run the "build_installer" process, find the generated sku.sis file for the installer and open it
with a text editor.<br />
Add the DLC AppID in the "apps" section. For example, if I had a game with AppID 1000 and DLC AppID
1010, I would adjust the "apps" section as follows:<br />
<div class="bb_code">"apps" { "0" "1000" "1" "1010" }</div>
This will ensure that Steam checks for ownership of the DLC and prompt the user for a key if the DLC
is not owned by the account that they are logging into on Steam.
<h2 class="bb_subsection">
    <a name="8"></a>Building a retail installer for multiple App IDs on a single disc/install
    package
</h2>
To build a GM containing multiple Steam Pipe apps. Build each app installer one by one but point
them all to the same output folder. Each build will merge itself with the already existing install
image.
<h2 class="bb_subsection"><a name="9"></a>Customizing a Retail install disk</h2>
See <a href="/doc/sdk/goldmaster">Customizing a gold master</a> for more details on customizing your
retail install disk.
<h2 class="bb_section"><a name="Preloading"></a>Preloading Games before Release</h2>
By default, all content is always encrypted, on all retail discs and on all content servers.
Switching a game to preload mode means owners can download the content, but it stays encrypted on
the users' disk and can't be played. Once the game becomes officially released, Steam will decrypt
the preloaded content and the user can play the game.<br />
<br />
Switching a game to preload mode is recommended in these cases:<br />
<ul>
    <li>
        Shipping retail discs with product keys before the game is actually available (0-day
        piracy).<br />
    </li>
    <li>Games that run a pre-purchase and are larger than 20GBs in size.</li>
</ul>
<br />
Please submit a ticket to Steam Publishing if you believe your game requires preloading.
<h2 class="bb_section"><a name="Building_DLC"></a>Building DLC</h2>
DLC is built as a depot of the base game. See the
<a href="/doc/store/application/dlc">Downloadable Content (DLC)</a> documentation for more
information.
<h2 class="bb_section"><a name="Troubleshooting_SteamPipe"></a>Troubleshooting SteamPipe</h2>
<h4>"Login Failure: Account Login Denied Failed" when logging in via steamcmd</h4>
Cause: Probably SteamGuard is preventing login. Resolution:<br />
<ul>
    <li>
        Check the email associated with the account you are trying to log on with and look for an
        email from Steam Support. Copy the code from that email.<br />
    </li>
    <li>
        Run the following steamcmd:
        <code class="bb_code bb_code_inline nohighlight">set_steam_guard_code &lt;code&gt;</code
        ><br />
    </li>
    <li>
        Re-Attempt login from steamcmd:
        <code class="bb_code bb_code_inline nohighlight"
            >Steam&gt;login &lt;buildaccount&gt; &lt;password&gt;</code
        >
    </li>
</ul>
<h4>General Troubleshooting for Download Issues</h4>
<ul>
    <li>Restart computer, modem, router, etc.<br /></li>
    <li>
        Verify firewall settings. The new system requires port 80 (HTTP) and all other Steam ports,
        listed
        <a
            href="https://support.steampowered.com/kb_article.php?ref=8571-GLVN-8711"
            target="_blank"
            rel="noreferrer"
            >here</a
        >.<br />
    </li>
    <li>Temporarily disable local Anti-Virus or Spam-Blocker programs.<br /></li>
    <li>
        Check the Steam download region under
        <strong>Settings</strong>-&gt;<strong>Downloads</strong>. It should match your location.<br />
    </li>
    <li>Stop the download, uninstall, and reinstall the game (clear manifest caches).<br /></li>
    <li>
        Exit Steam, delete the two folders appcache and depotcache in your Steam install folder.<br />
    </li>
    <li>
        Try to set your Steam download region to some other location far away. This might work if a
        content server near you is serving bad data.
    </li>
</ul>
<h4>My Mac and/or Linux Builds aren't installing any files. Why?</h4>
If you're testing via Steam the installation of your game or application across multiple platforms,
you may run into a situation where the build deploys on Windows but doesn't deploy any files on Mac
or Linux despite your SteamPipe process being setup to upload Mac and/or Linux depots. There is a
step that is easily missed which involves adding your alternate Depots to the Package being
deployed. You can check what depots are included in a package via the following steps:<br />
<ol>
    <li>Navigate to your <i>App Admin</i> page<br /></li>
    <li>
        From the View Associated Items section, click
        <i>All Associated Packages, DLC, Demos and Tools.</i><br />
    </li>
    <li>Click on the title of the Package you're attempting to download<br /></li>
    <li>Review the <i>Depots Included</i> section<br /></li>
    <li>
        Use the <i>Add/Remove Depots</i> to ensure the correct set of Depots are assigned to the
        Package
    </li>
</ol>
There are a number of discussion threads about this that may also assist:<br />
<ul>
    <li>
        <a
            href="http://steamcommunity.com/groups/steamworks/discussions/0/864972621123948611"
            target="_blank"
            rel="noreferrer"
            >Empty folder after installing the game</a
        ><br />
    </li>
    <li>
        <a
            href="http://steamcommunity.com/groups/steamworks/discussions/0/540742667593104506"
            target="_blank"
            rel="noreferrer"
            >Unity Builds for PC/Mac/Linux</a
        ><br />
    </li>
    <li>
        <a
            href="http://steamcommunity.com/groups/steamworks/discussions/0/540742667672176633"
            target="_blank"
            rel="noreferrer"
            >Preparing Content for Mac Packaging</a
        >
    </li>
</ul>
<h4>
    Running steamcmd.exe results in the following error: "SteamUpdater: Error: Steam needs to be
    online to update. Please confirm your network connection and try again."
</h4>
Resolution: Go to <strong>Internet Options</strong>-&gt;<strong>Connections</strong>-&gt;<strong
    >Lan Settings</strong
>
and check <strong>Automatically detect settings</strong>.
<h4>
    Running the app build results in the following error: "ERROR! Failed 'DepotBuild for
    scriptname.vdf' - status = 6."
</h4>
Possible Causes:<br />
<ul>
    <li>
        Account does not have permissions for the app.<br />
        <ul>
            <li>Check that the app ID is correct in the app_build.vdf.<br /></li>
            <li>
                Check that the build account has <a href="#Build_Account">proper permissions</a> to
                the app ID.<br />
            </li>
        </ul>
    </li>
    <li>
        Steamcmd cannot find the depot contents.<br />
        <ul>
            <li>
                Check that the "contentroot" value in the app_build script is a valid path relative
                to the location of the script file.<br />
            </li>
            <li>
                Check that the "LocalPath" value in the depot_build script is a valid path relative
                to the path in the app_build script. Check that the path contains actual content.<br />
            </li>
        </ul>
    </li>
</ul>
<h4>
    Running the app build results in the following error: "ERROR! Failed to get application info for
    app NNNNN (check login and subscription)"
</h4>
This means that Steam can't retrieve information about the app, either because it doesn't exist or
the user doesn't have access to the app.<br />
<ul>
    <li>Check that the NNNNN is the app ID you were assigned for the app.<br /></li>
    <li>Check that the app ID is correct in the app_build.vdf.<br /></li>
    <li>
        If it is a new app ID, check that the Steamworks app admin configuration has been published.
        New apps should have a Steam Pipe install directory as well as a depot, both can be found in
        Edit Steamwork Settings; the installation directory is in General Installation under the
        Installation tab, and Depots is under the SteamPipe tab. All changes published is done
        through the publish tab.<br />
    </li>
    <li>If all of that looks right, make sure that your account owns the app ID.</li>
</ul>
<h4>
    "An error occurred while installing [AppName] (Invalid content configuration)" at launch time
</h4>
Possible Causes:<br />
<ul>
    <li>
        No build has been set live on the branch you're trying to install from.<br />
        Resolution: Set your build live on a branch by going to
        <a href="/apps/builds/<YourGameAppId>" target="_blank" rel="noreferrer"
            >https://partner.steamgames.com/apps/builds/&lt;YourGameAppId&gt;</a
        >, and select that branch in the Steam client (as described
        <a href="#Building_Depots">here</a>).<br />
    </li>
    <li>
        Invalid game launch options.<br />
        Resolution: Verify the launch options on the Installation tab in the app admin for your game
        <a href="/apps/config/<YourGameAppId>" target="_blank" rel="noreferrer"
            >https://partner.steamgames.com/apps/config/&lt;YourGameAppId&gt;</a
        >.<br />
    </li>
    <li>
        You don't own the Depot IDs that make up the game.<br />
        Resolution: Make sure the necessary depots are added to the development subscription (See
        <a href="/doc/store/application/packages#editing_packages">Editing packages</a> for
        additional details).
    </li>
</ul>
<h4>I can't remember what that steamcmd command was or how it worked</h4>
Use the 'find' command in steamcmd to search for any steamcmd command. It will do partial matching
on the command name and it will list out the command syntax.<br />
<div class="bb_code nohighlight">
    Steam&gt;find build_installer ConVars: Commands: build_installer : &lt;project file&gt;
    &lt;target folder&gt; &lt;beta key&gt; &lt;beta pwd&gt;
</div>
